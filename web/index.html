<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wager Exchange</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0d1117; color: #c9d1d9; }
  .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
  h1 { color: #58a6ff; margin-bottom: 16px; }
  h2 { color: #58a6ff; margin: 16px 0 8px; font-size: 1.1em; }
  .tabs { display: flex; gap: 4px; margin-bottom: 16px; border-bottom: 1px solid #30363d; }
  .tab { padding: 8px 16px; cursor: pointer; border: none; background: none; color: #8b949e; font-size: 14px; border-bottom: 2px solid transparent; }
  .tab.active { color: #58a6ff; border-bottom-color: #58a6ff; }
  .panel { display: none; }
  .panel.active { display: block; }
  .card { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 16px; margin-bottom: 12px; }
  input, select, button { font-size: 14px; padding: 6px 12px; border-radius: 4px; border: 1px solid #30363d; background: #0d1117; color: #c9d1d9; }
  button { background: #238636; border-color: #238636; color: #fff; cursor: pointer; }
  button:hover { background: #2ea043; }
  button.danger { background: #da3633; border-color: #da3633; }
  .row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; flex-wrap: wrap; }
  table { width: 100%; border-collapse: collapse; font-size: 13px; }
  th, td { padding: 6px 8px; text-align: left; border-bottom: 1px solid #21262d; }
  th { color: #8b949e; font-weight: 600; }
  .bid { color: #3fb950; }
  .ask { color: #f85149; }
  .book-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  #auth-panel { margin-bottom: 16px; }
  .info { color: #8b949e; font-size: 13px; }
  .badge { display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 11px; font-weight: 600; }
  .badge-open { background: #238636; }
  .badge-resolved { background: #8957e5; }
  .badge-admin { background: #da3633; }
  #toast { position: fixed; top: 16px; right: 16px; padding: 12px 20px; background: #161b22; border: 1px solid #30363d; border-radius: 6px; display: none; z-index: 100; }
  .ws-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #da3633; margin-right: 4px; }
  .ws-dot.connected { background: #3fb950; }
</style>
</head>
<body>
<div class="container">
  <h1>Wager Exchange</h1>

  <!-- Auth -->
  <div id="auth-panel" class="card">
    <div class="row">
      <input id="auth-email" placeholder="email" value="admin@test.com">
      <input id="auth-pass" type="password" placeholder="password" value="password">
      <button onclick="doRegister()">Register</button>
      <button onclick="doLogin()">Login</button>
      <span id="auth-status" class="info"></span>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="trading">Trading</button>
    <button class="tab" data-tab="admin">Admin</button>
  </div>

  <!-- Trading Panel -->
  <div id="trading" class="panel active">
    <div class="row">
      <select id="market-select" onchange="selectMarket()"><option value="">-- select market --</option></select>
      <span id="market-status" class="info"></span>
      <span><span id="ws-dot" class="ws-dot"></span><span id="ws-status">disconnected</span></span>
    </div>

    <div class="book-cols">
      <div class="card">
        <h2>Bids</h2>
        <table><thead><tr><th>Price</th><th>Qty</th></tr></thead><tbody id="bids-body"></tbody></table>
      </div>
      <div class="card">
        <h2>Asks</h2>
        <table><thead><tr><th>Price</th><th>Qty</th></tr></thead><tbody id="asks-body"></tbody></table>
      </div>
    </div>

    <div class="card">
      <h2>Place Order</h2>
      <div class="row">
        <select id="order-side"><option value="BUY">BUY</option><option value="SELL">SELL</option></select>
        <select id="order-type"><option value="LIMIT">LIMIT</option><option value="MARKET">MARKET</option></select>
        <input id="order-price" type="number" placeholder="price (1-99)" min="1" max="99" style="width:120px">
        <input id="order-qty" type="number" placeholder="qty" min="1" value="1" style="width:80px">
        <button onclick="placeOrder()">Place</button>
      </div>
    </div>

    <div class="card">
      <h2>My Orders</h2>
      <table><thead><tr><th>ID</th><th>Side</th><th>Type</th><th>Price</th><th>Qty</th><th>Rem</th><th>Status</th><th></th></tr></thead>
      <tbody id="orders-body"></tbody></table>
    </div>

    <div class="card">
      <h2>Recent Trades</h2>
      <table><thead><tr><th>Price</th><th>Qty</th><th>Maker</th><th>Taker</th><th>Fee</th><th>Time</th></tr></thead>
      <tbody id="trades-body"></tbody></table>
    </div>

    <div class="card">
      <h2>Wallet</h2>
      <div id="wallet-info" class="info">Not loaded</div>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="admin" class="panel">
    <div class="card">
      <h2>Create Market</h2>
      <div class="row">
        <input id="mkt-slug" placeholder="slug">
        <input id="mkt-title" placeholder="title" style="width:250px">
        <input id="mkt-desc" placeholder="description" style="width:250px">
        <button onclick="createMarket()">Create</button>
      </div>
    </div>

    <div class="card">
      <h2>Resolve Market</h2>
      <div class="row">
        <select id="resolve-market"></select>
        <select id="resolve-to"><option value="YES">YES</option><option value="NO">NO</option></select>
        <button class="danger" onclick="resolveMarket()">Resolve</button>
      </div>
    </div>

    <div class="card">
      <h2>Deposit Funds</h2>
      <div class="row">
        <select id="deposit-user"></select>
        <input id="deposit-cents" type="number" placeholder="cents" value="100000">
        <button onclick="adminDeposit()">Deposit</button>
      </div>
    </div>

    <div class="card">
      <h2>Users</h2>
      <table><thead><tr><th>Email</th><th>Role</th><th>Balance</th><th>Locked</th></tr></thead>
      <tbody id="users-body"></tbody></table>
    </div>

    <div class="card">
      <h2>Metrics</h2>
      <div id="metrics-info" class="info">Not loaded</div>
      <button onclick="loadMetrics()" style="margin-top:8px">Refresh</button>
    </div>

    <div class="card">
      <h2>Event Log</h2>
      <table><thead><tr><th>ID</th><th>Type</th><th>Market</th><th>Seq</th><th>Payload</th><th>Time</th></tr></thead>
      <tbody id="events-body"></tbody></table>
      <button onclick="loadEvents()" style="margin-top:8px">Load</button>
    </div>
  </div>
</div>

<div id="toast"></div>
<script src="app.js"></script>
</body>
</html>
